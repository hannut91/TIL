# Express Production Best Practices

Production best practices: performance and reliability

## Performance

### Use gzip compression

* Gzip 압축은 응답 바디의 사이즈를 줄일 수 있어서 웹 앱의 속도를 높일 수
  있습니다.
* [compression](https://www.npmjs.com/package/compression) 미들웨어는
  Gzip압축을 지원하는 미들웨어 입니다.

```js
var compression = require('compression')
var express = require('express')
var app = express()
app.use(compression())
```

* 트레픽이 많은 웹사이트의 경우 더 좋은 방법은 reverse proxy 레벨에서 압축을
  사용하는 것입니다.([Use a reverse proxy](http://expressjs.com/en/advanced/best-practice-performance.html#use-a-reverse-proxy))
* 그럴 경우 미들웨어에서 압축을 사용할 필요가 없습니다.
* Nginx에서 Gzip압축을 사용하려면 다음을 참고하세요: [Module ngx_http_gzip_module](http://nginx.org/en/docs/http/ngx_http_gzip_module.html)

### Don't use synchronous functions

* 동기함수, 메소드는 일이 끝날 때 까지 프로세스를 묶어놓습니다. 동기함수로
  하나의 요청은 밀리초, 마이크로초에 처리가 끝날 수 있지만 높은 트래픽
  웹사이트에서는 앱의 성능을 저하시킵니다.
* Node가 동기, 비동기버전의 함수들을 지원하더라도 항상 비동기함수를
  사용해야합니다. 유일하기 동기함수를 사용할 수 있는 곳은 처음 서버가 시작될 때
  뿐입니다.
* 만약 Node.js 4.0이상을 쓰고 io.js 2.1.0이상을 쓰고 있다면
  `--trace-sync-io`플래그를 사용하면 앱이 동기API를 호출하는 것을 확인할 수
  있습니다.

### Do logging correctly

* 일반적으로 로깅을 하는 이유는 디버깅의 목적과 앱의 활동을 기록하는것입니다.
* 개발할 때 `console.log()`와 `console.error()`를 사용합니다. 하지만 이
  함수들은 터미널 혹은 파일로 출력할 때 동기 함수들입니다. 그래서 배포할 때는
  적합하지 않습니다.

#### For debugging

* 디버깅을 목적으로 한다면 `console.log()`보다는 [debug](https://www.npmjs.com/package/debug)를 사용하는 것이 좋습니다. 이 모듈은 `DEBUG`환경 변수를 사용하고
  앱이 비동기적으로 동작하도록 해줍니다.

#### For app activity

* 앱활동을 기록하려면 `console.log`대신 로깅 라이브러리를 사용하는 것이
  좋습니다.
  * [Winston](https://www.npmjs.com/package/winston)
  * [Bunyan](https://www.npmjs.com/package/bunyan)

## Sources

* <http://expressjs.com/en/advanced/best-practice-performance.html>
